<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ardra Dental Clinic - Billing System</title>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .loader {
            border: 5px solid #f3f4f6;
            border-top: 5px solid #7c3aed;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .premium-heading {
            font-family: 'Playfair Display', serif;
            letter-spacing: 2px;
        }
        .premium-tagline {
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
            letter-spacing: 1px;
        }
        .premium-body {
            font-family: 'Poppins', sans-serif;
        }
        @media print {
            body {
                background: white;
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            @page {
                margin: 0;
                size: A4;
            }
            body {
                margin: 1.5cm 1cm;
            }
            input, textarea, select {
                border: none !important;
                background: transparent !important;
            }
            button {
                display: none !important;
            }
            .no-print {
                display: none !important;
            }
            .print-border {
                border: 1px solid #e5e7eb !important;
            }
            .page-break-avoid {
                page-break-inside: avoid;
                break-inside: avoid;
            }
            .premium-card {
                box-shadow: none !important;
                border: 1px solid #e5e7eb !important;
            }
        }
        .premium-card {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .premium-border {
            border: 2px solid;
            border-image: linear-gradient(45deg, #7c3aed, #a78bfa) 1;
        }
    </style>
</head>
<body class="premium-body">
    <div id="loading">
        <div class="loader"></div>
    </div>
    <div id="root"></div>
    
    <script type="text/babel">
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loading = document.getElementById('loading');
                if (loading) loading.style.display = 'none';
            }, 500);
        });

        const { useState, useEffect } = React;

        const Icon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                printer: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>,
                plus: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
                trash: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
                calendar: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
                save: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /></svg>,
                mail: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>,
                edit: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
                check: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
                x: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
                phone: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>,
                download: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
            };
            return icons[name] || null;
        };

        function DentalBillingSystem() {
            const [invoiceDate, setInvoiceDate] = useState(new Date().toISOString().split('T')[0]);
            const [invoiceNumber, setInvoiceNumber] = useState('');
            const [patientName, setPatientName] = useState('');
            const [patientAge, setPatientAge] = useState('');
            const [patientPhone, setPatientPhone] = useState('');
            const [patientEmail, setPatientEmail] = useState('');
            const [patientLocation, setPatientLocation] = useState('');
            const [clinicalAssessment, setClinicalAssessment] = useState('');
            const [doctorName, setDoctorName] = useState('');
            const [otherDoctorName, setOtherDoctorName] = useState('');
            const [showOtherDoctor, setShowOtherDoctor] = useState(false);
            const [treatments, setTreatments] = useState([]);
            const [currentTreatment, setCurrentTreatment] = useState('');
            const [customDescription, setCustomDescription] = useState('');
            const [treatmentPlan, setTreatmentPlan] = useState('');
            const [currentPrice, setCurrentPrice] = useState('');
            const [discount, setDiscount] = useState('0');
            const [tax, setTax] = useState('18');
            const [paymentType, setPaymentType] = useState('');
            const [emiMonths, setEmiMonths] = useState('');
            const [downPayment, setDownPayment] = useState('');
            const [processingFee, setProcessingFee] = useState('0');
            const [emiTransactionId, setEmiTransactionId] = useState('');
            const [editingTreatment, setEditingTreatment] = useState(null);
            const [editValues, setEditValues] = useState({ name: '', price: '', plan: '' });
            const [saveStatus, setSaveStatus] = useState('');
            const [showCustomInput, setShowCustomInput] = useState(false);

            const commonTreatments = [
                'Root Canal Treatment',
                'Teeth Cleaning/Scaling',
                'Tooth Extraction',
                'Dental Filling',
                'Crown/Cap',
                'Bridge',
                'Dental Implant',
                'Teeth Whitening',
                'Orthodontic Braces',
                'Dentures',
                'Wisdom Tooth Removal',
                'Gum Treatment',
                'Veneer',
                'Consultation Fee',
                'Custom - Describe Service'
            ];

            const paymentTypes = ['UPI', 'Credit or Debit Card', 'Cash', 'EMI (Through SaveIn)'];

            useEffect(() => {
                const date = new Date(invoiceDate);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const invoiceCount = Math.floor(Math.random() * 1000) + 1;
                setInvoiceNumber(`ADC-${year}-${month}-${String(invoiceCount).padStart(4, '0')}`);
            }, [invoiceDate]);

            const handleTreatmentSelect = (value) => {
                if (value === 'Custom - Describe Service') {
                    setShowCustomInput(true);
                    setCurrentTreatment('');
                } else {
                    setShowCustomInput(false);
                    setCurrentTreatment(value);
                    setCustomDescription('');
                }
            };

            const addTreatment = () => {
                const treatmentName = showCustomInput ? customDescription : currentTreatment;
                if (treatmentName && currentPrice) {
                    setTreatments([...treatments, {
                        id: Date.now(),
                        name: treatmentName,
                        price: parseFloat(currentPrice),
                        plan: treatmentPlan
                    }]);
                    setCurrentTreatment('');
                    setCustomDescription('');
                    setTreatmentPlan('');
                    setCurrentPrice('');
                    setShowCustomInput(false);
                }
            };

            const startEdit = (treatment) => {
                setEditingTreatment(treatment.id);
                setEditValues({ name: treatment.name, price: treatment.price.toString(), plan: treatment.plan || '' });
            };

            const saveEdit = (id) => {
                if (editValues.name && editValues.price) {
                    setTreatments(treatments.map(t => 
                        t.id === id ? { ...t, name: editValues.name, price: parseFloat(editValues.price), plan: editValues.plan } : t
                    ));
                    setEditingTreatment(null);
                }
            };

            const cancelEdit = () => {
                setEditingTreatment(null);
                setEditValues({ name: '', price: '', plan: '' });
            };

            const removeTreatment = (id) => {
                setTreatments(treatments.filter(t => t.id !== id));
            };

            const calculateSubtotal = () => {
                return treatments.reduce((sum, treatment) => sum + treatment.price, 0);
            };

            const calculateDiscount = () => {
                return (calculateSubtotal() * parseFloat(discount || 0)) / 100;
            };

            const calculateTax = () => {
                const afterDiscount = calculateSubtotal() - calculateDiscount();
                return (afterDiscount * parseFloat(tax || 0)) / 100;
            };

            const calculateTotal = () => {
                return calculateSubtotal() - calculateDiscount() + calculateTax();
            };

            const calculateEMIAmount = () => {
                if (paymentType !== 'EMI (Through SaveIn)' || !emiMonths) return 0;
                const remainingAmount = calculateTotal() - parseFloat(downPayment || 0) + parseFloat(processingFee || 0);
                return remainingAmount / parseFloat(emiMonths);
            };

            // Update EMI amount whenever relevant values change
            useEffect(() => {
                if (paymentType === 'EMI (Through SaveIn)' && emiMonths && downPayment) {
                    // Auto-calculate, no manual override
                }
            }, [emiMonths, downPayment, processingFee, calculateTotal()]);

            const handleDoctorChange = (value) => {
                if (value === 'Others') {
                    setShowOtherDoctor(true);
                    setDoctorName('');
                } else {
                    setShowOtherDoctor(false);
                    setDoctorName(value);
                    setOtherDoctorName('');
                }
            };

            const handlePrint = () => {
                window.print();
            };

            const handleSaveAsFile = () => {
                setSaveStatus('saving');
                
                // Create invoice data
                const invoiceData = {
                    invoiceNumber,
                    invoiceDate,
                    patientName,
                    patientAge,
                    patientPhone,
                    patientEmail,
                    patientLocation,
                    clinicalAssessment,
                    doctorName: showOtherDoctor ? otherDoctorName : doctorName,
                    supervisingDoctor: showOtherDoctor ? 'Dr. Mounika Mokkapati' : null,
                    treatments,
                    subtotal: calculateSubtotal(),
                    discount,
                    tax,
                    total: calculateTotal(),
                    paymentType,
                    emiMonths: paymentType === 'EMI (Through SaveIn)' ? emiMonths : null,
                    downPayment: paymentType === 'EMI (Through SaveIn)' ? downPayment : null,
                    emiAmount: paymentType === 'EMI (Through SaveIn)' ? calculateEMIAmount() : null,
                    processingFee: paymentType === 'EMI (Through SaveIn)' ? processingFee : null,
                    emiTransactionId: paymentType === 'EMI (Through SaveIn)' ? emiTransactionId : null
                };

                // Convert to JSON and create a blob
                const dataStr = JSON.stringify(invoiceData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                // Create download link
                const url = window.URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Invoice_${invoiceNumber}_${patientName.replace(/\s+/g, '_')}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);

                setTimeout(() => {
                    setSaveStatus('saved');
                    setTimeout(() => setSaveStatus(''), 2000);
                }, 500);
            };

            const handleSendEmail = async () => {
                setSaveStatus('sending');
                
                // Create email content
                const emailSubject = `Invoice ${invoiceNumber} - Ardra Dental Clinic`;
                const emailBody = `Dear Team,

New invoice generated for patient: ${patientName}

Invoice Details:
- Invoice Number: ${invoiceNumber}
- Date: ${invoiceDate}
- Patient: ${patientName}, Age: ${patientAge}
${patientEmail ? `- Patient Email: ${patientEmail}` : ''}
${patientPhone ? `- Patient Phone: ${patientPhone}` : ''}
- Doctor: Dr. ${showOtherDoctor ? otherDoctorName : doctorName}
${showOtherDoctor ? `- Under Supervision of: Dr. Mounika Mokkapati` : ''}

Treatments:
${treatments.map(t => `- ${t.name}: ₹${t.price.toFixed(2)}`).join('\n')}

Financial Summary:
- Subtotal: ₹${calculateSubtotal().toFixed(2)}
- Discount: ${discount}% (₹${calculateDiscount().toFixed(2)})
- Tax (GST): ${tax}% (₹${calculateTax().toFixed(2)})
- Total Amount: ₹${calculateTotal().toFixed(2)}

Payment Details:
- Payment Type: ${paymentType}
${paymentType === 'EMI (Through SaveIn)' ? `- EMI Transaction ID: ${emiTransactionId || 'N/A'}\n- Down Payment: ₹${downPayment}\n- Processing Fee (SaveIn): ₹${processingFee}\n- EMI: ${emiMonths} months @ ₹${calculateEMIAmount().toFixed(2)}/month\n- Amount Financed (including processing fee): ₹${(calculateTotal() - parseFloat(downPayment) + parseFloat(processingFee || 0)).toFixed(2)}` : ''}

We pride in your radiant smile!

Best regards,
Ardra Dental Clinic
www.ardradentalclinics.com
Phone: 9059046833, 9032376833`;

                // Send only to clinic email
                const clinicMailtoLink = `mailto:ardradentalclinic@gmail.com?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
                
                // Open clinic email
                window.open(clinicMailtoLink, '_blank');

                setTimeout(() => {
                    setSaveStatus('sent');
                    setTimeout(() => setSaveStatus(''), 3000);
                }, 1500);
            };

            const clearForm = () => {
                setPatientName('');
                setPatientAge('');
                setPatientPhone('');
                setPatientEmail('');
                setPatientLocation('');
                setClinicalAssessment('');
                setDoctorName('');
                setOtherDoctorName('');
                setShowOtherDoctor(false);
                setTreatments([]);
                setCurrentTreatment('');
                setCustomDescription('');
                setTreatmentPlan('');
                setCurrentPrice('');
                setDiscount('0');
                setTax('18');
                setPaymentType('');
                setEmiMonths('');
                setDownPayment('');
                setProcessingFee('0');
                setEmiTransactionId('');
                setShowCustomInput(false);
                setInvoiceDate(new Date().toISOString().split('T')[0]);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 p-4 md:p-8">
                    <div className="max-w-5xl mx-auto">
                        {/* Premium Header */}
                        <div className="premium-card rounded-lg shadow-2xl p-8 mb-6 page-break-avoid premium-border">
                            <div className="flex flex-col md:flex-row justify-between items-start gap-6">
                                <div className="flex items-start gap-6 flex-1">
                                    <img 
                                        src="https://raw.githubusercontent.com/ardradental/Bill/main/logo.png"
                                        alt="Ardra Dental Clinic Logo" 
                                        className="w-32 h-32 object-contain"
                                        onError={(e) => {
                                            console.log('Logo failed to load, trying fallback...');
                                            e.target.onerror = null;
                                            // Fallback to a purple ADC placeholder
                                            e.target.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128"%3E%3Crect width="128" height="128" fill="%237c3aed" rx="10"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" font-family="Arial, sans-serif" font-size="36" font-weight="bold" fill="white"%3EARDRA%3C/text%3E%3Ctext x="50%25" y="75%25" dominant-baseline="middle" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="white"%3EDENTAL%3C/text%3E%3C/svg%3E';
                                        }}
                                    />
                                    <div>
                                        <h1 className="text-4xl font-bold text-purple-800 mb-1 premium-heading">ARDRA DENTAL CLINIC</h1>
                                        <p className="text-xl text-purple-600 mb-3 premium-tagline">We pride in your radiant smile</p>
                                        <p className="text-gray-600 mb-2 text-sm">www.ardradentalclinics.com</p>
                                        <div className="flex items-center gap-2 text-gray-600 text-sm">
                                            <Icon name="phone" className="w-4 h-4" />
                                            <span>9059046833, 9032376833</span>
                                        </div>
                                    </div>
                                </div>
                                <div className="text-left md:text-right">
                                    <div className="text-sm font-semibold text-gray-700 mb-2">Invoice Number</div>
                                    <input
                                        type="text"
                                        value={invoiceNumber}
                                        onChange={(e) => setInvoiceNumber(e.target.value)}
                                        className="px-3 py-2 border-2 border-purple-300 rounded-lg text-sm font-mono bg-purple-50"
                                    />
                                    <div className="flex items-center gap-2 mt-3">
                                        <Icon name="calendar" className="w-4 h-4" />
                                        <input
                                            type="date"
                                            value={invoiceDate}
                                            onChange={(e) => setInvoiceDate(e.target.value)}
                                            className="px-3 py-2 border-2 border-purple-300 rounded-lg text-sm bg-purple-50"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Patient Information */}
                        <div className="premium-card rounded-lg shadow-lg p-6 mb-6 page-break-avoid">
                            <h2 className="text-2xl font-semibold text-purple-800 mb-4 premium-heading">Patient Information</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Patient Name *</label>
                                    <input
                                        type="text"
                                        value={patientName}
                                        onChange={(e) => setPatientName(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        placeholder="Enter patient name"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Age *</label>
                                    <input
                                        type="number"
                                        value={patientAge}
                                        onChange={(e) => setPatientAge(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        placeholder="Age"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                    <input
                                        type="tel"
                                        value={patientPhone}
                                        onChange={(e) => setPatientPhone(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        placeholder="Phone"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                    <input
                                        type="email"
                                        value={patientEmail}
                                        onChange={(e) => setPatientEmail(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        placeholder="Email"
                                    />
                                </div>
                            </div>
                            <div className="grid grid-cols-1 gap-4 mt-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Patient Location</label>
                                    <input
                                        type="text"
                                        value={patientLocation}
                                        onChange={(e) => setPatientLocation(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        placeholder="Location"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Clinical Assessment of the Patient's Condition</label>
                                    <textarea
                                        value={clinicalAssessment}
                                        onChange={(e) => setClinicalAssessment(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        placeholder="Enter clinical assessment and patient's condition..."
                                        rows="4"
                                    />
                                </div>
                            </div>
                        </div>

                        {/* Doctor Information */}
                        <div className="premium-card rounded-lg shadow-lg p-6 mb-6 page-break-avoid">
                            <h2 className="text-2xl font-semibold text-purple-800 mb-4 premium-heading">Doctor Information</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Treated By Dr. *</label>
                                    <select
                                        value={showOtherDoctor ? 'Others' : doctorName}
                                        onChange={(e) => handleDoctorChange(e.target.value)}
                                        className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white"
                                    >
                                        <option value="">-- Select Doctor --</option>
                                        <option value="Mounika Mokkapati">Mounika Mokkapati</option>
                                        <option value="Others">Others</option>
                                    </select>
                                </div>
                                {showOtherDoctor && (
                                    <>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Other Doctor Name *</label>
                                            <input
                                                type="text"
                                                value={otherDoctorName}
                                                onChange={(e) => setOtherDoctorName(e.target.value)}
                                                className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                placeholder="Enter doctor name"
                                            />
                                        </div>
                                        <div className="md:col-span-2">
                                            <div className="bg-purple-100 border-2 border-purple-400 rounded-lg p-4">
                                                <p className="text-purple-900 font-semibold">
                                                    ✓ Under the supervision of Dr. Mounika Mokkapati
                                                </p>
                                            </div>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>

                        {/* Treatment Details */}
                        <div className="premium-card rounded-lg shadow-lg p-6 mb-6">
                            <h2 className="text-2xl font-semibold text-purple-800 mb-4 premium-heading">Treatment Details</h2>
                            
                            <div className="grid grid-cols-1 gap-4 mb-4 no-print">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Select Treatment</label>
                                    <select
                                        value={showCustomInput ? 'Custom - Describe Service' : currentTreatment}
                                        onChange={(e) => handleTreatmentSelect(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    >
                                        <option value="">-- Select Treatment --</option>
                                        {commonTreatments.map((treatment, idx) => (
                                            <option key={idx} value={treatment}>{treatment}</option>
                                        ))}
                                    </select>
                                </div>

                                {showCustomInput && (
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Describe Custom Service</label>
                                        <textarea
                                            value={customDescription}
                                            onChange={(e) => setCustomDescription(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            placeholder="Enter detailed description of the service provided..."
                                            rows="3"
                                        />
                                    </div>
                                )}

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Treatment Plan & Follow-up</label>
                                    <textarea
                                        value={treatmentPlan}
                                        onChange={(e) => setTreatmentPlan(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        placeholder="Describe the complete treatment plan and follow-up instructions..."
                                        rows="4"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Price (₹)</label>
                                    <input
                                        type="number"
                                        value={currentPrice}
                                        onChange={(e) => setCurrentPrice(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        placeholder="Enter price"
                                        onKeyPress={(e) => e.key === 'Enter' && addTreatment()}
                                    />
                                </div>
                            </div>

                            <button
                                onClick={addTreatment}
                                disabled={(!currentTreatment && !customDescription) || !currentPrice}
                                className="w-full md:w-auto px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center gap-2 mb-6 disabled:bg-gray-400 disabled:cursor-not-allowed no-print font-semibold"
                            >
                                <Icon name="plus" />
                                Add Treatment
                            </button>

                            {treatments.length > 0 && (
                                <div className="border-2 border-purple-200 rounded-lg overflow-hidden mb-6 print-border">
                                    <table className="w-full">
                                        <thead className="bg-gradient-to-r from-purple-100 to-purple-50">
                                            <tr>
                                                <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">Treatment/Service</th>
                                                <th className="px-4 py-3 text-left text-sm font-semibold text-purple-900">Treatment Plan</th>
                                                <th className="px-4 py-3 text-right text-sm font-semibold text-purple-900">Price (₹)</th>
                                                <th className="px-4 py-3 text-center text-sm font-semibold text-purple-900 no-print">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-purple-100">
                                            {treatments.map((treatment) => (
                                                <tr key={treatment.id} className="hover:bg-purple-50">
                                                    {editingTreatment === treatment.id ? (
                                                        <>
                                                            <td className="px-4 py-3">
                                                                <textarea
                                                                    value={editValues.name}
                                                                    onChange={(e) => setEditValues({...editValues, name: e.target.value})}
                                                                    className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                                                                    rows="2"
                                                                />
                                                            </td>
                                                            <td className="px-4 py-3">
                                                                <textarea
                                                                    value={editValues.plan}
                                                                    onChange={(e) => setEditValues({...editValues, plan: e.target.value})}
                                                                    className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                                                                    rows="2"
                                                                />
                                                            </td>
                                                            <td className="px-4 py-3">
                                                                <input
                                                                    type="number"
                                                                    value={editValues.price}
                                                                    onChange={(e) => setEditValues({...editValues, price: e.target.value})}
                                                                    className="w-full px-2 py-1 border border-gray-300 rounded text-sm text-right"
                                                                />
                                                            </td>
                                                            <td className="px-4 py-3 text-center no-print">
                                                                <div className="flex items-center justify-center gap-2">
                                                                    <button onClick={() => saveEdit(treatment.id)} className="text-green-600 hover:text-green-800">
                                                                        <Icon name="check" className="w-4 h-4" />
                                                                    </button>
                                                                    <button onClick={cancelEdit} className="text-gray-600 hover:text-gray-800">
                                                                        <Icon name="x" className="w-4 h-4" />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </>
                                                    ) : (
                                                        <>
                                                            <td className="px-4 py-3 text-sm text-gray-800 font-medium">{treatment.name}</td>
                                                            <td className="px-4 py-3 text-sm text-gray-600">{treatment.plan || '-'}</td>
                                                            <td className="px-4 py-3 text-sm text-gray-800 text-right font-semibold">₹ {treatment.price.toFixed(2)}</td>
                                                            <td className="px-4 py-3 text-center no-print">
                                                                <div className="flex items-center justify-center gap-2">
                                                                    <button onClick={() => startEdit(treatment)} className="text-purple-600 hover:text-purple-800">
                                                                        <Icon name="edit" className="w-4 h-4" />
                                                                    </button>
                                                                    <button onClick={() => removeTreatment(treatment.id)} className="text-red-600 hover:text-red-800">
                                                                        <Icon name="trash" className="w-4 h-4" />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </>
                                                    )}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            )}

                            {treatments.length > 0 && (
                                <div className="bg-gradient-to-br from-purple-50 via-blue-50 to-cyan-50 rounded-lg p-6 border-2 border-purple-300 page-break-avoid">
                                    <h3 className="text-2xl font-semibold text-purple-900 mb-4 premium-heading">Invoice Summary</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between items-center pb-2">
                                            <span className="text-gray-800 font-medium text-lg">Subtotal:</span>
                                            <span className="font-semibold text-xl text-gray-900">₹ {calculateSubtotal().toFixed(2)}</span>
                                        </div>
                                        
                                        <div className="flex justify-between items-center border-t-2 border-purple-200 pt-2">
                                            <div className="flex items-center gap-2">
                                                <span className="text-gray-800 font-medium text-lg">Discount:</span>
                                                <input
                                                    type="number"
                                                    value={discount}
                                                    onChange={(e) => setDiscount(e.target.value)}
                                                    className="w-20 px-2 py-1 border-2 border-purple-300 rounded text-sm bg-white"
                                                    min="0"
                                                    max="100"
                                                />
                                                <span className="text-sm text-gray-600 font-medium">%</span>
                                            </div>
                                            <span className="font-semibold text-xl text-red-600">- ₹ {calculateDiscount().toFixed(2)}</span>
                                        </div>

                                        <div className="flex justify-between items-center pb-2">
                                            <span className="text-gray-700 text-lg">Amount after Discount:</span>
                                            <span className="font-semibold text-lg text-gray-900">₹ {(calculateSubtotal() - calculateDiscount()).toFixed(2)}</span>
                                        </div>

                                        <div className="flex justify-between items-center border-t-2 border-purple-200 pt-2">
                                            <div className="flex items-center gap-2">
                                                <span className="text-gray-800 font-medium text-lg">Tax (GST):</span>
                                                <input
                                                    type="number"
                                                    value={tax}
                                                    onChange={(e) => setTax(e.target.value)}
                                                    className="w-20 px-2 py-1 border-2 border-purple-300 rounded text-sm bg-white"
                                                    min="0"
                                                    max="100"
                                                />
                                                <span className="text-sm text-gray-600 font-medium">%</span>
                                            </div>
                                            <span className="font-semibold text-xl text-green-600">+ ₹ {calculateTax().toFixed(2)}</span>
                                        </div>

                                        <div className="border-t-4 border-purple-500 pt-4 flex justify-between items-center bg-white rounded-lg p-4 mt-3 shadow-lg">
                                            <span className="text-2xl font-bold text-purple-900 premium-heading">Total Amount Payable:</span>
                                            <span className="text-4xl font-bold text-purple-800 premium-heading">₹ {calculateTotal().toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Payment Information */}
                        {treatments.length > 0 && (
                            <div className="premium-card rounded-lg shadow-lg p-6 mb-6 page-break-avoid">
                                <h2 className="text-2xl font-semibold text-purple-800 mb-4 premium-heading">Payment Information</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Payment Type *</label>
                                        <select
                                            value={paymentType}
                                            onChange={(e) => setPaymentType(e.target.value)}
                                            className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white"
                                        >
                                            <option value="">-- Select Payment Type --</option>
                                            {paymentTypes.map((type, idx) => (
                                                <option key={idx} value={type}>{type}</option>
                                            ))}
                                        </select>
                                    </div>

                                    {paymentType === 'EMI (Through SaveIn)' && (
                                        <>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Initial Down Payment (₹) *</label>
                                                <input
                                                    type="number"
                                                    value={downPayment}
                                                    onChange={(e) => setDownPayment(e.target.value)}
                                                    className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    placeholder="Enter down payment amount"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Number of EMI Months *</label>
                                                <input
                                                    type="number"
                                                    value={emiMonths}
                                                    onChange={(e) => setEmiMonths(e.target.value)}
                                                    className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    placeholder="Enter number of months"
                                                    min="1"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Processing Fee - SaveIn (₹)</label>
                                                <input
                                                    type="number"
                                                    value={processingFee}
                                                    onChange={(e) => setProcessingFee(e.target.value)}
                                                    className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    placeholder="Enter SaveIn processing fee"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">EMI Transaction ID</label>
                                                <input
                                                    type="text"
                                                    value={emiTransactionId}
                                                    onChange={(e) => setEmiTransactionId(e.target.value)}
                                                    className="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    placeholder="Enter SaveIn transaction ID"
                                                />
                                            </div>
                                            {emiMonths && downPayment && (
                                                <div className="md:col-span-2">
                                                    <div className="bg-purple-100 border-2 border-purple-400 rounded-lg p-4">
                                                        <div className="flex items-center justify-between mb-3">
                                                            <h3 className="text-lg font-semibold text-purple-900">EMI Calculation (SaveIn)</h3>
                                                        </div>
                                                        <div className="space-y-2 text-sm">
                                                            <div className="flex justify-between">
                                                                <span className="font-medium">Total Invoice Amount:</span>
                                                                <span className="font-bold">₹ {calculateTotal().toFixed(2)}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span className="font-medium">Down Payment:</span>
                                                                <span className="font-bold text-green-600">- ₹ {parseFloat(downPayment).toFixed(2)}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span className="font-medium">Processing Fee (SaveIn):</span>
                                                                <span className="font-bold text-orange-600">+ ₹ {parseFloat(processingFee || 0).toFixed(2)}</span>
                                                            </div>
                                                            <div className="flex justify-between border-t-2 border-purple-300 pt-2">
                                                                <span className="font-medium">Amount to be Financed:</span>
                                                                <span className="font-bold">₹ {(calculateTotal() - parseFloat(downPayment) + parseFloat(processingFee || 0)).toFixed(2)}</span>
                                                            </div>
                                                            <div className="bg-purple-200 p-3 rounded mt-2">
                                                                <div className="flex justify-between items-center">
                                                                    <span className="font-bold">EMI per Month ({emiMonths} months):</span>
                                                                    <span className="font-bold text-purple-900 text-xl">₹ {calculateEMIAmount().toFixed(2)}</span>
                                                                </div>
                                                            </div>
                                                            <div className="flex justify-between bg-green-100 p-2 rounded border-2 border-green-400 mt-2">
                                                                <span className="font-bold text-green-900">Total Amount Paid Through EMI:</span>
                                                                <span className="font-bold text-green-900">₹ {(calculateEMIAmount() * parseFloat(emiMonths)).toFixed(2)}</span>
                                                            </div>
                                                            {emiTransactionId && (
                                                                <div className="flex justify-between bg-blue-100 p-2 rounded border-2 border-blue-400 mt-2">
                                                                    <span className="font-bold text-blue-900">Transaction ID:</span>
                                                                    <span className="font-bold text-blue-900">{emiTransactionId}</span>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </>
                                    )}

                                    {paymentType && paymentType !== 'EMI (Through SaveIn)' && (
                                        <div className="md:col-span-2">
                                            <div className="bg-green-100 border-2 border-green-400 rounded-lg p-4">
                                                <p className="text-green-800 font-semibold">
                                                    ✓ Payment Type: {paymentType}
                                                </p>
                                                <p className="text-green-700 mt-1">
                                                    Amount Paid: ₹ {calculateTotal().toFixed(2)}
                                                </p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Signature Section */}
                        {(doctorName || otherDoctorName) && treatments.length > 0 && paymentType && (
                            <div className="premium-card rounded-lg shadow-lg p-6 mb-6 page-break-avoid">
                                <div className="flex justify-between items-center">
                                    <div className="text-left">
                                        <p className="text-gray-700 text-sm mb-2 font-medium">Authorized Signature</p>
                                        <p className="font-bold text-purple-800 text-3xl premium-tagline mb-4" style={{fontFamily: 'cursive'}}>
                                            Ardra Dental Clinic
                                        </p>
                                        <div className="mt-3 pt-2 border-t border-gray-300">
                                            <p className="text-xs text-gray-500">This is a computer generated invoice</p>
                                        </div>
                                    </div>
                                    <div className="relative">
                                        <div className="text-7xl font-bold text-green-500 opacity-30 transform -rotate-12 border-4 border-green-500 px-8 py-4 rounded-lg shadow-lg">
                                            PAID
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Action Buttons */}
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4 no-print mb-6">
                            <button
                                onClick={handlePrint}
                                disabled={!patientName || !patientAge || (showOtherDoctor ? !otherDoctorName : !doctorName) || treatments.length === 0 || !paymentType}
                                className="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed font-semibold shadow-lg"
                            >
                                <Icon name="printer" />
                                Print Invoice
                            </button>
                            
                            <button
                                onClick={handleSaveAsFile}
                                disabled={!patientName || !patientAge || (showOtherDoctor ? !otherDoctorName : !doctorName) || treatments.length === 0 || !paymentType}
                                className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed font-semibold shadow-lg"
                            >
                                <Icon name="download" />
                                {saveStatus === 'saving' ? 'Saving...' : saveStatus === 'saved' ? 'Saved!' : 'Download Invoice'}
                            </button>

                            <button
                                onClick={handleSendEmail}
                                disabled={!patientName || !patientAge || (showOtherDoctor ? !otherDoctorName : !doctorName) || treatments.length === 0 || !paymentType}
                                className="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed font-semibold shadow-lg"
                            >
                                <Icon name="mail" />
                                {saveStatus === 'sending' ? 'Sending...' : saveStatus === 'sent' ? 'Sent!' : 'Send Email'}
                            </button>

                            <button
                                onClick={clearForm}
                                className="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-semibold shadow-lg"
                            >
                                Clear All
                            </button>
                        </div>

                        {/* Status Messages */}
                        {saveStatus && (
                            <div className="mt-4 p-4 bg-green-50 border-2 border-green-300 rounded-lg text-center no-print shadow-lg">
                                {saveStatus === 'saved' && <p className="text-green-700 font-semibold text-lg">✓ Invoice downloaded successfully!</p>}
                                {saveStatus === 'sent' && (
                                    <div>
                                        <p className="text-green-700 font-semibold text-lg">✓ Email opened to send to clinic!</p>
                                        <p className="text-green-600 text-sm mt-1">Sending to: ardradentalclinic@gmail.com</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Premium Footer */}
                        <div className="mt-8 pt-6 border-t-2 border-purple-300 text-center text-sm text-gray-700 page-break-avoid">
                            <p className="font-bold text-xl text-purple-800 mb-3 premium-heading">Thank you for choosing ARDRA DENTAL CLINIC</p>
                            <p className="text-sm leading-relaxed mb-2 font-medium">Metro Pillar No:A835, Opp Ashoka One Mall, 2nd Floor, above Ola & BornBabies,<br />Kukatpally, Hyderabad, Telangana 500072</p>
                            <p className="font-medium">www.ardradentalclinics.com | Email: ardradentalclinic@gmail.com</p>
                            <p className="mt-2 font-medium">Contact: 9059046833, 9032376833</p>
                            <p className="mt-3 text-purple-600 premium-tagline text-base">We pride in your radiant smile</p>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DentalBillingSystem />);
    </script>
</body>
</html>
